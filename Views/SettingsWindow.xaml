<Window x:Class="DerivSmartBotDesktop.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:services="clr-namespace:DerivSmartBotDesktop.Services"
        Title="Settings"
        Height="520" Width="760"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource WindowBackgroundBrush}">
    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Grid.Column="0" Background="{DynamicResource PanelBackgroundBrush}"
                BorderBrush="{DynamicResource PanelBorderBrush}" BorderThickness="1" CornerRadius="10" Padding="10">
            <StackPanel>
                <TextBlock Text="Settings" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <ListBox SelectedIndex="0">
                    <ListBoxItem Content="Connection"/>
                    <ListBoxItem Content="Trading"/>
                    <ListBoxItem Content="Risk"/>
                    <ListBoxItem Content="Strategies"/>
                    <ListBoxItem Content="Appearance"/>
                </ListBox>
            </StackPanel>
        </Border>

        <Border Grid.Row="0" Grid.Column="1" Background="{DynamicResource PanelBackgroundBrush}"
                BorderBrush="{DynamicResource PanelBorderBrush}" BorderThickness="1" CornerRadius="10" Padding="16" Margin="12,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="Connection" FontWeight="SemiBold" FontSize="14"/>
                    <TextBlock Text="Deriv API configuration" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>

                    <TextBlock Text="App ID" Margin="0,12,0,4"/>
                    <TextBox Text="{Binding AppId, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>

                    <TextBlock Text="API Token" Margin="0,12,0,4"/>
                    <PasswordBox services:PasswordBoxHelper.BindPassword="True"
                                 services:PasswordBoxHelper.BoundPassword="{Binding ApiToken, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Default Symbol" Margin="0,12,0,4"/>
                    <TextBox Text="{Binding Symbol, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>

                    <TextBlock Text="Watchlist (comma separated)" Margin="0,12,0,4"/>
                    <TextBox Text="{Binding WatchlistCsv, UpdateSourceTrigger=PropertyChanged}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="72"/>

                    <TextBlock Text="Mode" Margin="0,12,0,4"/>
                    <StackPanel Orientation="Horizontal">
                        <RadioButton Content="Demo" IsChecked="{Binding IsDemo}" Margin="0,0,12,0"/>
                        <RadioButton Content="Live" IsChecked="{Binding IsDemo, Converter={StaticResource BoolInverseConverter}}"/>
                    </StackPanel>

                    <TextBlock Text="Trading" Margin="0,16,0,4" FontWeight="SemiBold"/>
                    <CheckBox Content="Forward test" IsChecked="{Binding ForwardTestEnabled}"/>
                    <CheckBox Content="Relax gates" IsChecked="{Binding RelaxEnvironmentForTesting}" IsEnabled="{Binding RelaxEnvironmentEnabled}"/>

                    <TextBlock Text="Risk Controls" Margin="0,16,0,4" FontWeight="SemiBold"/>
                    <TextBlock Text="Daily drawdown (%)" Margin="0,8,0,4"/>
                    <TextBox Text="{Binding DailyDrawdownPercent, UpdateSourceTrigger=PropertyChanged}"/>
                    <TextBlock Text="Max daily loss ($)" Margin="0,8,0,4"/>
                    <TextBox Text="{Binding MaxDailyLossAmount, UpdateSourceTrigger=PropertyChanged}"/>
                    <TextBlock Text="Max consecutive losses" Margin="0,8,0,4"/>
                    <TextBox Text="{Binding MaxConsecutiveLosses, UpdateSourceTrigger=PropertyChanged}"/>
                    <TextBlock Text="Trade cooldown (seconds)" Margin="0,8,0,4"/>
                    <TextBox Text="{Binding TradeCooldownSeconds, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Appearance" Margin="0,16,0,4" FontWeight="SemiBold"/>
                    <ComboBox SelectedItem="{Binding SelectedTheme}" ItemsSource="{Binding ThemeOptions}" Width="140"/>

                    <Button Content="Test Connection" Command="{Binding TestConnectionCommand}" Margin="0,16,0,0" Width="160"/>
                    <TextBlock Text="{Binding TestStatus}" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,6,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="1" Grid.ColumnSpan="2" Background="{DynamicResource TopBarBackgroundBrush}"
                BorderBrush="{DynamicResource DividerBrush}" BorderThickness="1,0,0,0" Padding="12" Margin="0,12,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Cancel" Command="{Binding CancelCommand}" Margin="0,0,8,0"/>
                <Button Content="Save" Style="{StaticResource PrimaryButton}" Command="{Binding SaveCommand}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
